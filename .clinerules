# .clinerules — merged: cost-optimized + Memory Bank
version: 1

providers:
  # Use Cline credits or your direct provider key in Cline settings (no OpenRouter required)

models:
  cheap_default:
    name: openai/gpt-4o-mini
    temperature: 0.18
    max_output_tokens: 1500

  code_specialist:
    name: deepseek/deepseek-v3
    temperature: 0.15
    max_output_tokens: 1800

  smart_fallback:
    name: anthropic/claude-sonnet-4
    temperature: 0.20
    max_output_tokens: 6000

defaults:
  model_order:
    - cheap_default
    - code_specialist
    - smart_fallback

  system_message: |
    You are Cline's coding assistant.
    Follow these strict rules:
    - ALWAYS respond with a single fenced block containing only a unified diff or git-apply-able patch.
    - DO NOT include explanations, reasoning steps, or commentary unless explicitly asked.
    - If a one-line note is absolutely necessary, put it AFTER the patch.

  # Spend tokens on code, not chatter
  style:
    verbosity: "terse"
    reasoning: "suppress"
    prefer_edits_over_long_explanations: true
    code_block_preference: "minimal"

  output_prefs:
    prefer_patch: true
    prefer_diff: "unified"
    prose_explanation_max_chars: 160

  cost_limits:
    max_cost_per_run_usd: 0.03
    max_cost_per_session_usd: 0.40
    on_limit: "ask-before-continue"

  tools:
    allow_shell: true
    allow_git: true
    allow_fs: true
    confirm_before_risky_ops: true
    allow_browser: false

  context:
    # Include Memory Bank files so Cline can read them first
    include_globs:
      - "memory-bank/**/*.md"
      - "**/*.{ts,tsx,js,jsx,py,md}"
      - "package*.json"
      - "pnpm-lock.yaml"
      - "yarn.lock"
      - "requirements.txt"
    exclude_globs:
      - "node_modules/**"
      - ".git/**"
      - "dist/**"
      - "build/**"
      - ".next/**"
      - ".cache/**"
      - "**/*.map"
      - "**/*.min.*"
      - "**/*.lock"
      - "**/*.{png,jpg,jpeg,webp,pdf}"
      - ".env*"
    max_files: 50
    max_file_size_kb: 300

# ——— Memory Bank: short, structured, always read first ———
instructions: |
  ## Memory Bank Protocol (Terse)
  Before ANY task, first read all markdown files in ./memory-bank in this order:
  1) projectbrief.md  2) techContext.md  3) systemPatterns.md  4) productContext.md
  5) activeContext.md  6) progress.md
  If a file is missing, create a minimal version with the headings below. Keep each file concise (<5 KB).
  During/after the task, update activeContext.md (current decisions/state) and append a dated entry to progress.md (what changed, why).

  ### File templates (create if missing)
  - projectbrief.md: goals, non-goals, constraints.
  - techContext.md: stack, repos, env, build/run cmds.
  - systemPatterns.md: conventions, module boundaries, naming, testing strategy.
  - productContext.md: users, workflows, acceptance criteria.
  - activeContext.md: open tasks, decisions, TODOs next.
  - progress.md: YYYY-MM-DD — change summary + links/commits.

  ### Output discipline
  - Diff/patch-first replies; no long prose. One-line summary only if essential.

presets:
  cheap:
    model: cheap_default
    temperature: 0.18
    max_output_tokens: 1200
    note: "Everyday edits, reviews, small fixes — diff only."

  codegen:
    model: code_specialist
    temperature: 0.15
    max_output_tokens: 1800
    note: "Generate/translate code with minimal prose."

  smart:
    model: smart_fallback
    temperature: 0.2
    max_output_tokens: 6000
    note: "Large refactors/plans; still diff-first, terse."

escalation_rules:
  - when: "multiple_files_refactor_with_tests"
    prefer_model: smart_fallback
  - when: "analysis_tokens_over_40k_or_context_overflow"
    prefer_model: smart_fallback
  - when: "heavy_code_synthesis_or_transpile"
    prefer_model: code_specialist
