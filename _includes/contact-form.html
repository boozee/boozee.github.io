<form id="contact-form"
      action="https://formspree.io/f/xvgqnrvk"
      method="POST"
      class="contact-form"
      novalidate>
  <div class="cf-field">
    <label for="cf-email">Your email</label>
    <input id="cf-email" type="email" name="email" autocomplete="email" required>
  </div>

  <div class="cf-field">
    <label for="cf-message">Message</label>
    <textarea id="cf-message" name="message" rows="5" required></textarea>
  </div>

  <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off">

  <button id="cf-submit" type="submit" disabled>Send</button>

  <p id="cf-status" class="cf-status" aria-live="polite"></p>
</form>

<div id="cf-success" class="cf-success" style="display:none; text-align:center; margin-top:2rem;">
  <img src="{{ "/assets/img/puppy-thanks.png" | relative_url }}"
       alt="Cute puppy"
       style="max-width:420px; border-radius:12px; display:block; margin:1rem auto 0;">
  <p style="margin-top:1rem;"><a href="{{ "/" | relative_url }}">← Back to home</a></p>
</div>

<script>
const emailEl = document.getElementById("cf-email");
const msgEl   = document.getElementById("cf-message");
const submitBtn = document.getElementById("cf-submit");

function updateButton() {
  const emailOk = emailEl.value.trim() !== "" && emailEl.checkValidity(); // valid email
  const msgOk   = msgEl.value.trim().length > 0 && msgEl.checkValidity(); // not empty (and >= minlength)
  submitBtn.disabled = !(emailOk && msgOk);
  submitBtn.setAttribute("aria-disabled", String(submitBtn.disabled));
}

// react to typing, pasting, autofill, etc.
["input","change","keyup"].forEach(ev => {
  emailEl.addEventListener(ev, updateButton);
  msgEl.addEventListener(ev, updateButton);
});

// initialize (handles browser autofill too)
updateButton();
setTimeout(updateButton, 0);

// Handle form submission
(function () {
  const form = document.getElementById("contact-form");
  const submitBtn = document.getElementById("cf-submit");
  const success = document.getElementById("cf-success");
  const status = document.getElementById("cf-status");

  async function handleSubmit(e) {
    e.preventDefault();

    // basic HTML5 validity
    if (!form.reportValidity()) return;

    status.textContent = "Sending…";
    submitBtn.disabled = true;

    try {
      const res = await fetch(form.action, {
        method: "POST",
        body: new FormData(form),
        headers: { "Accept": "application/json" }
      });

      if (res.ok) {
        form.reset();
        form.style.display = "none";
        success.style.display = "block";
        status.textContent = "";
      } else {
        // Try to show Formspree error details if any
        let msg = "There was a problem submitting the form. Please try again.";
        try {
          const data = await res.json();
          if (data && data.errors && data.errors.length) {
            msg = data.errors.map(e => e.message).join(" ");
          }
        } catch (_) {}
        status.textContent = msg;
        submitBtn.disabled = false;
      }
    } catch (err) {
      status.textContent = "Network error. Check your connection and try again.";
      submitBtn.disabled = false;
    }
  }

  form.addEventListener("submit", handleSubmit);
})();
</script>